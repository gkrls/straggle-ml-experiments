
data = {
  4 : { # pipes
    128 : { # window
      8 : { # threads
        5: { # tx_interval
          "rank-0" : {
            1 : [{ 'tid': 0, 'pkt': [12208,0], 't_burst': 65, 't_first': 1112, 't0': {'n': 2048, 'min': 50, 'max': 1150, 'mean': 182.54, 'std':  244.36, 'p': [122,1112,1142] }, 't1': {'n': 1208, 'min': 50, 'max': 147, 'mean': 119.66, 'std': 7.48, 'p': [120,127,139] }, 'ti': {'n': 2048, 'min': 0, 'max': 8, 'mean': 0.06, 'std': 0.29, 'p': [0,1,1] } },
                 { 'tid': 0, 'pkt': [12208,0], 't_burst': 77, 't_first': 3119, 't0': {'n': 2048, 'min': 96, 'max': 3231, 'mean': 313.13, 'std':  737.40, 'p': [122,3132,3210] }, 't1': {'n': 1208, 'min': 38, 'max': 188, 'mean': 119.64, 'std': 10.08, 'p': [120,134,146] }, 'ti': {'n': 2048, 'min': 0, 'max': 8, 'mean': 0.12, 'std': 0.36, 'p': [0,1,1] } },
                 { 'tid': 0, 'pkt': [12208,0], 't_burst': 78, 't_first': 6935, 't0': {'n': 2048, 'min': 67, 'max': 6995, 'mean': 548.85, 'std': 1655.97, 'p': [121,6944,6984] }, 't1': {'n': 1208, 'min': 67, 'max': 146, 'mean': 120.35, 'std': 5.83, 'p': [120,133,138] }, 'ti': {'n': 2048, 'min': 0, 'max': 3, 'mean': 0.05, 'std': 0.23, 'p': [0,1,1] } }],

            2 : [{ 'tid': 0, 'pkt': [12208,0], 't_burst': 25, 't_first':  88, 't0': {'n': 2048, 'min': 88, 'max': 144, 'mean': 116.08, 'std':  8.40, 'p': [118,126,129] }, 't1': {'n': 1208, 'min': 80, 'max': 132, 'mean': 118.93, 'std': 4.98, 'p': [120,125,127] }, 'ti': {'n': 2048, 'min': 0, 'max': 1, 'mean': 0.05, 'std': 0.22, 'p': [0,0,1] } },
                 { 'tid': 0, 'pkt': [12208,0], 't_burst': 25, 't_first': 106, 't0': {'n': 2048, 'min': 64, 'max': 147, 'mean': 114.32, 'std': 12.43, 'p': [118,127,139] }, 't1': {'n': 1208, 'min': 66, 'max': 133, 'mean': 118.56, 'std': 5.86, 'p': [120,124,128] }, 'ti': {'n': 2048, 'min': 0, 'max': 2, 'mean': 0.06, 'std': 0.24, 'p': [0,1,1] } },
                 { 'tid': 0, 'pkt': [12208,0], 't_burst': 27, 't_first': 103, 't0': {'n': 2048, 'min': 78, 'max': 167, 'mean': 113.62, 'std': 13.39, 'p': [118,127,155] }, 't1': {'n': 1208, 'min': 79, 'max': 138, 'mean': 118.40, 'std': 6.43, 'p': [120,125,127] }, 'ti': {'n': 2048, 'min': 0, 'max': 7, 'mean': 0.05, 'std': 0.26, 'p': [0,0,1] } }]
          },
          "rank-1" : {
            1 : [{ 'tid': 0, 'pkt': [12208,0], 't_burst': 65, 't_first': 3044, 't0': {'n': 2048, 'min': 45, 'max': 3089, 'mean': 302.86, 'std':  712.82, 'p': [122,3044,3077] }, 't1': {'n': 1208, 'min': 45, 'max': 205, 'mean': 119.42, 'std': 11.90, 'p': [120,127,167] }, 'ti': {'n': 2048, 'min': 0, 'max': 9, 'mean': 0.15, 'std': 0.41, 'p': [0,1,1] } },
                 { 'tid': 0, 'pkt': [12208,0], 't_burst': 64, 't_first': 5164, 't0': {'n': 2048, 'min': 97, 'max': 5274, 'mean': 441.07, 'std': 1232.14, 'p': [122,5174,5253] }, 't1': {'n': 1208, 'min': 83, 'max': 162, 'mean': 119.79, 'std': 7.52, 'p': [120,134,140] }, 'ti': {'n': 2048, 'min': 0, 'max': 1, 'mean': 0.05, 'std': 0.21, 'p': [0,0,1] } },
                 { 'tid': 0, 'pkt': [12208,0], 't_burst': 78, 't_first': 7725, 't0': {'n': 2048, 'min': 68, 'max': 7793, 'mean': 597.60, 'std': 1847.83, 'p': [121,7729,7780] }, 't1': {'n': 1208, 'min': 46, 'max': 212, 'mean': 120.14, 'std': 10.81, 'p': [120,133,165] }, 'ti': {'n': 2048, 'min': 0, 'max': 3, 'mean': 0.13, 'std': 0.34, 'p': [0,1,1] } }],

            2 : [{ 'tid': 0, 'pkt': [12208,0], 't_burst': 27, 't_first':  86, 't0': {'n': 2048, 'min': 86, 'max': 139, 'mean': 115.68, 'std':  8.46, 'p': [118,126,128] }, 't1': {'n': 1208, 'min': 81, 'max': 133, 'mean': 118.74, 'std': 4.94, 'p': [120,124,127] }, 'ti': {'n': 2048, 'min': 0, 'max': 1, 'mean': 0.06, 'std': 0.24, 'p': [0,1,1] } },
                 { 'tid': 0, 'pkt': [12208,0], 't_burst': 26, 't_first': 103, 't0': {'n': 2048, 'min': 66, 'max': 144, 'mean': 114.27, 'std': 12.32, 'p': [118,127,135] }, 't1': {'n': 1208, 'min': 66, 'max': 134, 'mean': 118.65, 'std': 5.87, 'p': [120,124,127] }, 'ti': {'n': 2048, 'min': 0, 'max': 1, 'mean': 0.06, 'std': 0.23, 'p': [0,1,1] } },
                 { 'tid': 0, 'pkt': [12208,0], 't_burst': 28, 't_first': 103, 't0': {'n': 2048, 'min': 77, 'max': 167, 'mean': 113.36, 'std': 13.28, 'p': [117,126,154] }, 't1': {'n': 1208, 'min': 77, 'max': 136, 'mean': 118.24, 'std': 6.33, 'p': [119,125,127] }, 'ti': {'n': 2048, 'min': 0, 'max': 1, 'mean': 0.06, 'std': 0.24, 'p': [0,1,1] } }]
          },
          "rank-2" : {
            1 : [{ 'tid': 0, 'pkt': [12208,0], 't_burst': 69, 't_first':  935, 't0': {'n': 2048, 'min': 46, 'max':  982, 'mean': 173.91, 'std': 202.33, 'p': [122,935,970]   }, 't1': {'n': 1208, 'min': 47, 'max': 199, 'mean': 119.43, 'std': 11.40, 'p': [120,127,167] }, 'ti': {'n': 2048, 'min': 0, 'max': 14, 'mean': 0.13, 'std': 0.45, 'p': [0,1,1] } },
                 { 'tid': 0, 'pkt': [12208,0], 't_burst': 89, 't_first': 3835, 't0': {'n': 2048, 'min': 96, 'max': 3943, 'mean': 357.89, 'std': 910.04, 'p': [123,3845,3923] }, 't1': {'n': 1208, 'min': 83, 'max': 162, 'mean': 119.74, 'std': 7.50, 'p': [120,134,141] }, 'ti': {'n': 2048, 'min': 0, 'max': 1, 'mean': 0.05, 'std': 0.22, 'p': [0,0,1] } },
                 { 'tid': 0, 'pkt': [12208,0], 't_burst': 77, 't_first':   61, 't0': {'n': 2048, 'min': 61, 'max':  139, 'mean': 117.89, 'std':  13.28, 'p': [120,135,138]   }, 't1': {'n': 1208, 'min': 39, 'max': 221, 'mean': 119.94, 'std': 11.19, 'p': [120,129,176] }, 'ti': {'n': 2048, 'min': 0, 'max': 2, 'mean': 0.14, 'std': 0.35, 'p': [0,1,1] } }],
            
            2 : [{ 'tid': 0, 'pkt': [12208,0], 't_burst': 32, 't_first':  81, 't0': {'n': 2048, 'min': 81, 'max': 136, 'mean': 115.60, 'std':  8.78, 'p': [119,126,129] }, 't1': {'n': 1208, 'min': 81, 'max': 130, 'mean': 118.80, 'std': 4.87, 'p': [120,124,127] }, 'ti': {'n': 2048, 'min': 0, 'max': 1, 'mean': 0.05, 'std': 0.22, 'p': [0,1,1] } },
                 { 'tid': 0, 'pkt': [12208,0], 't_burst': 27, 't_first': 103, 't0': {'n': 2048, 'min': 63, 'max': 145, 'mean': 113.58, 'std': 12.43, 'p': [117,127,138] }, 't1': {'n': 1208, 'min': 67, 'max': 136, 'mean': 118.16, 'std': 5.94, 'p': [119,123,127] }, 'ti': {'n': 2048, 'min': 0, 'max': 2, 'mean': 0.08, 'std': 0.27, 'p': [0,1,1] } },
                 { 'tid': 0, 'pkt': [12208,0], 't_burst': 29, 't_first': 102, 't0': {'n': 2048, 'min': 76, 'max': 165, 'mean': 113.25, 'std': 13.38, 'p': [118,127,152] }, 't1': {'n': 1208, 'min': 79, 'max': 137, 'mean': 118.31, 'std': 6.40, 'p': [119,125,127] }, 'ti': {'n': 2048, 'min': 0, 'max': 6, 'mean': 0.06, 'std': 0.26, 'p': [0,1,1] } }]
          },
          "rank-3" : {
            1: [{ 'tid': 0, 'pkt': [12208,0], 't_burst': 69, 't_first': 2008, 't0': {'n': 2048, 'min': 48, 'max': 2053, 'mean': 238.51, 'std': 461.85, 'p': [122,2008,2043] }, 't1': {'n': 1208, 'min': 49, 'max': 146, 'mean': 119.59, 'std': 7.56, 'p': [120,127,138] }, 'ti': {'n': 2048, 'min': 0, 'max': 6, 'mean': 0.06, 'std': 0.27, 'p': [0,1,1] } },
                { 'tid': 0, 'pkt': [12208,0], 't_burst': 72, 't_first':   58, 't0': {'n': 2048, 'min': 58, 'max':  166, 'mean': 121.77, 'std':  13.35, 'p': [122,138,148]   }, 't1': {'n': 1208, 'min': 84, 'max': 165, 'mean': 119.76, 'std': 7.58, 'p': [120,133,140] }, 'ti': {'n': 2048, 'min': 0, 'max': 1, 'mean': 0.06, 'std': 0.24, 'p': [0,1,1] } },
                { 'tid': 0, 'pkt': [12208,0], 't_burst': 76, 't_first': 2859, 't0': {'n': 2048, 'min': 67, 'max': 2918, 'mean': 293.94, 'std': 668.46, 'p': [121,2858,2904] }, 't1': {'n': 1208, 'min': 67, 'max': 145, 'mean': 120.21, 'std': 5.73, 'p': [120,133,138] }, 'ti': {'n': 2048, 'min': 0, 'max': 3, 'mean': 0.06, 'std': 0.24, 'p': [0,1,1] } }],
            
            2: [{ 'tid': 0, 'pkt': [12208,0], 't_burst': 28, 't_first':  86, 't0': {'n': 2048, 'min': 86, 'max': 140, 'mean': 116.07, 'std':  8.40, 'p': [119,126,129] }, 't1': {'n': 1208, 'min': 81, 'max': 130, 'mean': 119.02, 'std': 4.83, 'p': [120,125,127] }, 'ti': {'n': 2048, 'min': 0, 'max': 7, 'mean': 0.05, 'std': 0.26, 'p': [0,0,1] } },
                { 'tid': 0, 'pkt': [12208,0], 't_burst': 25, 't_first': 105, 't0': {'n': 2048, 'min': 63, 'max': 146, 'mean': 114.41, 'std': 12.39, 'p': [118,127,137] }, 't1': {'n': 1208, 'min': 65, 'max': 133, 'mean': 118.78, 'std': 5.83, 'p': [120,124,127] }, 'ti': {'n': 2048, 'min': 0, 'max': 6, 'mean': 0.04, 'std': 0.24, 'p': [0,0,1] } },
                { 'tid': 0, 'pkt': [12208,0], 't_burst': 27, 't_first': 104, 't0': {'n': 2048, 'min': 78, 'max': 168, 'mean': 113.85, 'std': 13.41, 'p': [118,127,156] }, 't1': {'n': 1208, 'min': 79, 'max': 139, 'mean': 118.57, 'std': 6.27, 'p': [120,125,127] }, 'ti': {'n': 2048, 'min': 0, 'max': 6, 'mean': 0.04, 'std': 0.24, 'p': [0,0,1] } }]
          }
        },
        10: {
          "rank-0": {
              1: [],
              2: []
          }
        }
      }
    }
  }
}

import matplotlib.pyplot as plt
import numpy as np
from matplotlib.patches import Patch

# Extract data
D = data[4][128][8][5]
r0 = D["rank-0"]

# Helper functions
def get_vals(data, key, ar_num):
    return [rep[key] for rep in data[ar_num]]

def get_nested_vals(data, key1, key2, ar_num):
    return [rep[key1][key2] for rep in data[ar_num]]

# Create plots
fig, axes = plt.subplots(2, 3, figsize=(15, 8))

# 1. First packet arrival - all ranks
ax = axes[0, 0]
colors = ['steelblue', 'forestgreen', 'darkorange', 'purple']
width = 0.18
for i, (rank, color) in enumerate(zip(D.keys(), colors)):
    t1 = get_vals(D[rank], 't_first', 1)
    t2 = get_vals(D[rank], 't_first', 2)
    x = np.arange(3)
    # AR1 bars
    ax.bar(x - 0.3 + i*width, t1, width, label=f'{rank}-AR1',
           color=color, alpha=0.7)
    # AR2 bars  
    ax.bar(x + 0.3 + i*width, t2, width, label=f'{rank}-AR2',
           color=color, alpha=0.4, hatch='//')
ax.set_xlabel('Repeat')
ax.set_ylabel('Time (μs)')
ax.set_title('First Packet Arrival Time (All Ranks)')
ax.set_yscale('log')
ax.legend(bbox_to_anchor=(1.05, 1), loc='upper left', fontsize=8, ncol=2)
ax.grid(True, alpha=0.3)

# 2. Mean packet times t0 vs t1 - rank-0
ax = axes[0, 1]
for ar, color in [(1, 'steelblue'), (2, 'coral')]:
    x = np.arange(3) + (ar-1)*0.4
    ax.errorbar(x-0.15, get_nested_vals(r0, 't0', 'mean', ar), 
                yerr=get_nested_vals(r0, 't0', 'std', ar),
                fmt='o-', label=f'AR{ar}-t0', color=color, capsize=5)
    ax.errorbar(x+0.15, get_nested_vals(r0, 't1', 'mean', ar),
                yerr=get_nested_vals(r0, 't1', 'std', ar),  
                fmt='s--', label=f'AR{ar}-t1', color=color, capsize=5)
ax.set_xlabel('Repeat')
ax.set_ylabel('Mean Time (μs)')
ax.set_title('Rank-0: Mean Packet Times')
ax.set_yscale('log')
ax.legend()
ax.grid(True, alpha=0.3)

# 3. Std deviation - rank-0  
ax = axes[0, 2]
for ar, color in [(1, 'steelblue'), (2, 'coral')]:
    ax.plot(np.arange(3), get_nested_vals(r0, 't0', 'std', ar),
            'o-', label=f'AR{ar}-t0', color=color, linewidth=2)
    ax.plot(np.arange(3), get_nested_vals(r0, 't1', 'std', ar),
            's--', label=f'AR{ar}-t1', color=color, linewidth=2)
ax.set_xlabel('Repeat')
ax.set_ylabel('Std Dev (μs)')
ax.set_title('Rank-0: Timing Variability')
ax.set_yscale('log')
ax.legend()
ax.grid(True, alpha=0.3)

# 4. Burst times - rank-0
ax = axes[1, 0]
width = 0.35
for ar, color in [(1, 'steelblue'), (2, 'coral')]:
    vals = get_vals(r0, 't_burst', ar)
    x = np.arange(3)
    ax.bar(x + (ar-1.5)*width, vals, width, label=f'Allreduce {ar}', color=color, alpha=0.8)
    mean, std = np.mean(vals), np.std(vals)
    ax.axhline(mean, color=color, linestyle='--', alpha=0.5)
    ax.fill_between([-0.5, 2.5], mean-std, mean+std, color=color, alpha=0.1)
ax.set_xlabel('Repeat')
ax.set_ylabel('Time (μs)')
ax.set_title('Rank-0: Burst Duration')
ax.legend()
ax.grid(True, alpha=0.3)

# 5. Processing time - rank-0
ax = axes[1, 1]
for ar, color in [(1, 'steelblue'), (2, 'coral')]:
    means = get_nested_vals(r0, 'ti', 'mean', ar)
    stds = get_nested_vals(r0, 'ti', 'std', ar)
    maxs = get_nested_vals(r0, 'ti', 'max', ar)
    x = np.arange(3)
    ax.errorbar(x, means, yerr=stds, fmt='o-', label=f'AR{ar}-mean', color=color, capsize=5)
    ax.plot(x, maxs, '^:', label=f'AR{ar}-max', color=color, alpha=0.7)
ax.set_xlabel('Repeat')
ax.set_ylabel('Processing Time (μs)')
ax.set_title('Rank-0: Packet Processing Time')
ax.legend()
ax.grid(True, alpha=0.3)

# 6. Summary comparison - rank-0
ax = axes[1, 2]
metrics = ['t_first\n(avg)', 't0_mean\n(avg)', 't1_mean\n(avg)', 't_burst\n(avg)']
vals = []
errs = []
for ar in [1, 2]:
    vals.append([
        np.mean(get_vals(r0, 't_first', ar)),
        np.mean(get_nested_vals(r0, 't0', 'mean', ar)),
        np.mean(get_nested_vals(r0, 't1', 'mean', ar)),
        np.mean(get_vals(r0, 't_burst', ar))
    ])
    errs.append([
        np.std(get_vals(r0, 't_first', ar)),
        np.std(get_nested_vals(r0, 't0', 'mean', ar)),
        np.std(get_nested_vals(r0, 't1', 'mean', ar)),
        np.std(get_vals(r0, 't_burst', ar))
    ])

x = np.arange(len(metrics))
width = 0.35
for i, (v, e, color, label) in enumerate(zip(vals, errs, ['steelblue', 'coral'], ['Allreduce 1', 'Allreduce 2'])):
    bars = ax.bar(x + (i-0.5)*width, v, width, yerr=e, label=label, color=color, 
                  alpha=0.8, capsize=5, error_kw={'linewidth': 1.5})
    for bar in bars:
        h = bar.get_height()
        ax.text(bar.get_x() + bar.get_width()/2, h, f'{h:.0f}' if h > 100 else f'{h:.1f}',
                ha='center', va='bottom', fontsize=9)
ax.set_xlabel('Metric')
ax.set_ylabel('Time (μs)')
ax.set_title('Rank-0: Average Metrics')
ax.set_xticks(x)
ax.set_xticklabels(metrics)
ax.set_yscale('log')
ax.legend()
ax.grid(True, alpha=0.3)

plt.suptitle('Rank-0 Allreduce Performance Analysis\n(4 pipes, 128 window, 8 threads, 5 tx_interval)', fontsize=14)
plt.tight_layout()
# plt.savefig('/home/claude/allreduce_analysis.png', dpi=150, bbox_inches='tight')
# print("Plot saved as 'allreduce_analysis.png'")
plt.show()

# Print summary
print("\n=== SUMMARY ===")
for rank in D.keys():
    ar1_avg = np.mean(get_vals(D[rank], 't_first', 1))
    ar2_avg = np.mean(get_vals(D[rank], 't_first', 2))
    print(f"{rank}: AR1={ar1_avg:.0f}μs, AR2={ar2_avg:.0f}μs, Ratio={ar1_avg/ar2_avg:.1f}x")

# # Save the figure
# # plt.savefig('/home/claude/allreduce_analysis.png', dpi=150, bbox_inches='tight')
# # print("Plot saved as 'allreduce_analysis.png'")

# # Also save individual plots for better viewing
# fig2, axes2 = plt.subplots(1, 2, figsize=(12, 5))

# # Plot 1: First packet arrival comparison
# ax = axes2[0]
# t_first_1 = [rep['t_first'] for rep in rank0_data[1]]
# t_first_2 = [rep['t_first'] for rep in rank0_data[2]]
# x = np.arange(3)
# width = 0.35
# bars1 = ax.bar(x - width/2, t_first_1, width, label='Allreduce 1', color='steelblue', alpha=0.8)
# bars2 = ax.bar(x + width/2, t_first_2, width, label='Allreduce 2', color='coral', alpha=0.8)

# # Add value labels
# for bars in [bars1, bars2]:
#     for bar in bars:
#         height = bar.get_height()
#         ax.annotate(f'{height:.0f}',
#                     xy=(bar.get_x() + bar.get_width() / 2, height),
#                     xytext=(0, 3),
#                     textcoords="offset points",
#                     ha='center', va='bottom', fontsize=10, fontweight='bold')

# ax.set_xlabel('Repeat', fontsize=12)
# ax.set_ylabel('Time (μs)', fontsize=12)
# ax.set_title('First Packet Arrival Time Comparison', fontsize=14, fontweight='bold')
# ax.set_xticks(x)
# ax.set_xticklabels(['Rep 0', 'Rep 1', 'Rep 2'])
# ax.legend(fontsize=11)
# ax.grid(True, alpha=0.3)
# ax.set_yscale('log')  # Use log scale due to large difference

# # Plot 2: t0 vs t1 mean comparison
# ax = axes2[1]
# repeats_x = []
# t0_values = []
# t1_values = []
# colors = []
# labels = []

# for allreduce_num, color in [(1, 'steelblue'), (2, 'coral')]:
#     for i in range(3):
#         repeats_x.append(f'A{allreduce_num}-R{i}')
#         t0_values.append(rank0_data[allreduce_num][i]['t0']['mean'])
#         t1_values.append(rank0_data[allreduce_num][i]['t1']['mean'])
#         colors.append(color)

# x_pos = np.arange(len(repeats_x))
# width = 0.35

# bars1 = ax.bar(x_pos - width/2, t0_values, width, label='t0 (first 2048)', alpha=0.8)
# bars2 = ax.bar(x_pos + width/2, t1_values, width, label='t1 (next 1208)', alpha=0.8)

# # Color bars by allreduce
# for i, bar in enumerate(bars1):
#     bar.set_color(colors[i])
#     bar.set_alpha(0.6)
# for i, bar in enumerate(bars2):
#     bar.set_color(colors[i])
#     bar.set_alpha(0.9)

# ax.set_xlabel('Allreduce-Repeat', fontsize=12)
# ax.set_ylabel('Mean Time (μs)', fontsize=12)
# ax.set_title('Packet Timing: t0 vs t1', fontsize=14, fontweight='bold')
# ax.set_xticks(x_pos)
# ax.set_xticklabels(repeats_x, rotation=45)
# ax.legend(fontsize=11)
# ax.grid(True, alpha=0.3)

# # Add separator line between allreduce 1 and 2
# ax.axvline(x=2.5, color='gray', linestyle='--', alpha=0.5)
# ax.text(1, ax.get_ylim()[1]*0.9, 'Allreduce 1', fontsize=11, ha='center', color='steelblue', fontweight='bold')
# ax.text(4, ax.get_ylim()[1]*0.9, 'Allreduce 2', fontsize=11, ha='center', color='coral', fontweight='bold')

# plt.suptitle('Rank-0 Detailed Comparison', fontsize=15, fontweight='bold')
# plt.tight_layout()
# # plt.savefig('/home/claude/allreduce_detailed.png', dpi=150, bbox_inches='tight')
# # print("Detailed plot saved as 'allreduce_detailed.png'")

# # Print summary statistics
# print("\n=== RANK-0 SUMMARY STATISTICS ===\n")
# for allreduce_num in [1, 2]:
#     print(f"Allreduce {allreduce_num}:")
#     repeats = rank0_data[allreduce_num]
    
#     print(f"  First packet arrival times: {[r['t_first'] for r in repeats]} μs")
#     print(f"  Average t_first: {np.mean([r['t_first'] for r in repeats]):.2f} ± {np.std([r['t_first'] for r in repeats]):.2f} μs")
    
#     print(f"  t0 means: {['{:.2f}'.format(r['t0']['mean']) for r in repeats]} μs")
#     print(f"  t1 means: {['{:.2f}'.format(r['t1']['mean']) for r in repeats]} μs")
    
#     print(f"  Average burst time: {np.mean([r['t_burst'] for r in repeats]):.2f} ± {np.std([r['t_burst'] for r in repeats]):.2f} μs")
#     print()

# print("Key Observations:")
# print(f"  - Allreduce 1 has much higher first packet latency ({np.mean([r['t_first'] for r in rank0_data[1]]):.0f} vs {np.mean([r['t_first'] for r in rank0_data[2]]):.0f} μs)")
# print(f"  - Allreduce 1 shows higher variability in t0 (std: {np.mean([r['t0']['std'] for r in rank0_data[1]]):.0f} vs {np.mean([r['t0']['std'] for r in rank0_data[2]]):.0f} μs)")
# print(f"  - t1 timings are more consistent across both allreduce calls (~119-120 μs)")
# print(f"  - Burst times are longer for Allreduce 1 ({np.mean([r['t_burst'] for r in rank0_data[1]]):.0f} vs {np.mean([r['t_burst'] for r in rank0_data[2]]):.0f} μs)")
