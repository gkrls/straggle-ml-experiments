  + exec python -u /home/gks/straggle-ml-experiments/models/gpt2_4.py --rank 0 --world_size 6 --iface ens4f0 --master_addr 42.0.0.1 --master_port 29500 --backend gloo --workers 8 --json /home/gks/straggle-ml-experiments/models/gpt2.json --data /home/gks/datasets/openwebtext --cache_dir /home/gks/datasets/openwebtext/cache --prefetch_factor 4 --epochs 25          
[DDP] backend=gloo world_size=6 master=42.0.0.1:29500 iface=ens4f0 local_rank=0                                                                                                                                                                                                                                                                                            
Configuration:                                                                                                                                                                                                                                                                                                                                                             
{                                                                                                                                                                                                                                                                                                                                                                          
  "rank": 0,                                                                                                                                                                                                                                                                                                                                                               
  "world_size": 6,                                                                                                                                                                                                                                                                                                                                                         
  "iface": "ens4f0",                                                                                                                                                                                                                                                                                                                                                       
  "master_addr": "42.0.0.1",                                                                                                                                                                                                                                                                                                                                               
  "master_port": 29500,                                                                                                                                                                                                                                                                                                                                                    
  "backend": "gloo",                                                                                                                                                                                                                                                                                                                                                       
  "device": "cuda",                                                                                                                                                                                                                                                                                                                                                        
  "deterministic": false,                                                                                                                                                                                                                                                                                                                                                  
  "static_graph": false,                                                                                                                                                                                                                                                                                                                                                   
  "workers": 8,                                                                                                                                                                                                                                                                                                                                                            
  "json": "/home/gks/straggle-ml-experiments/models/gpt2.json",                                                                                                                                                                                                                                                                                                            
  "seed": 1337,                                                                                                                                                                                                                                                                                                                                                            
  "data": "/home/gks/datasets/openwebtext",                                                                                                                                                                                                                                                                                                                                
  "cache_dir": "/home/gks/datasets/openwebtext/cache",                                                                                                                                                                                                                                                                                                                     
  "val_fraction": 0.0005,
  "tokenizer": "gpt2",
  "epochs": 25,
  "steps_per_epoch": 500,
  "batch_size": 12,
  "gradient_accumulation_steps": 5,
  "learning_rate": 0.0006,
  "min_lr": 6e-05,
  "warmup_iters": 200,
  "lr_decay_iters": 5000,
  "weight_decay": 0.1,
  "grad_clip": 1.0,
  "amp": true,
  "prefetch_factor": 4,
  "seq_len": 1024,
  "dropout": 0.1,
  "local_rank": 0
}
Loading Parquet dataset from /home/gks/datasets/openwebtext (cache: /home/gks/datasets/openwebtext/cache) ...
Resolving data files: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 27/27 [00:00<00:00, 254485.86it/s]
Loading dataset shards: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 73/73 [00:00<00:00, 1953.64it/s]

DATA ROOT: /home/gks/datasets/openwebtext
  Train docs: 7,934,153 | Val docs: 79,616
  Vocab size: 50,257
  Seq len: 1024

Model: GPT-2 small (124M parameters)
  Total parameters: 124,439,808
  Learning rate: 0.0006
  Batch size per GPU: 12
  Total batch size: 72
  Gradient accumulation steps: 5
  Effective batch size: 360
============================================================
[2025-09-03 00:49:43][Epoch 000] Starting... first 200 steps are warmup...
[2025-09-03 00:49:46][Epoch 000][Step 0000/0500] Loss: 10.9367 | LR: 0.000003 (warmup) | Grad Norm: 13.32
[2025-09-03 00:51:27][Epoch 000][Step 0050/0500] Loss: 7.1698 | LR: 0.000153 (warmup) | Grad Norm: 0.86
[2025-09-03 00:53:07][Epoch 000][Step 0100/0500] Loss: 6.9205 | LR: 0.000303 (warmup) | Grad Norm: 0.90
[2025-09-03 00:54:48][Epoch 000][Step 0150/0500] Loss: 6.8319 | LR: 0.000453 (warmup) | Grad Norm: 0.68
[2025-09-03 00:56:29][Epoch 000][Step 0200/0500] Loss: 6.1153 | LR: 0.000600 (warmup) | Grad Norm: 0.60
[2025-09-03 01:06:58][Epoch 000] train_loss=6.4231 train_ppl=631.16 val_loss=5.7899 val_ppl=326.97 lr=0.000595 time=1008.00s tok/s=6095
[2025-09-03 01:24:12][Epoch 001] train_loss=5.3976 train_ppl=225.61 val_loss=5.1499 val_ppl=172.42 lr=0.000564 time=1007.32s tok/s=6099
[2025-09-03 01:41:27][Epoch 002] train_loss=4.8852 train_ppl=134.28 val_loss=4.7085 val_ppl=110.89 lr=0.000508 time=1008.21s tok/s=6094
[2025-09-03 01:58:43][Epoch 003] train_loss=4.4802 train_ppl=88.51 val_loss=4.4225 val_ppl=83.30 lr=0.000433 time=1009.04s tok/s=6089
[2025-09-03 02:16:00][Epoch 004] train_loss=4.2255 train_ppl=68.25 val_loss=4.2679 val_ppl=71.37 lr=0.000348 time=1009.85s tok/s=6084
[2025-09-03 02:33:16][Epoch 005] train_loss=4.0485 train_ppl=56.80 val_loss=4.1713 val_ppl=64.80 lr=0.000260 time=1009.92s tok/s=6084
[2025-09-03 02:50:34][Epoch 006] train_loss=3.9109 train_ppl=49.47 val_loss=4.1069 val_ppl=60.76 lr=0.000180 time=1011.16s tok/s=6076
[2025-09-03 03:07:53][Epoch 007] train_loss=3.8050 train_ppl=44.42 val_loss=4.0627 val_ppl=58.13 lr=0.000116 time=1011.56s tok/s=6074
[2025-09-03 03:25:13][Epoch 008] train_loss=3.7274 train_ppl=41.06 val_loss=4.0395 val_ppl=56.80 lr=0.000074 time=1013.33s tok/s=6063
[2025-09-03 03:42:33][Epoch 009] train_loss=3.6757 train_ppl=38.95 val_loss=4.0265 val_ppl=56.06 lr=0.000060 time=1013.46s tok/s=6062
[2025-09-03 03:59:55][Epoch 010] train_loss=3.6450 train_ppl=37.77 val_loss=4.0197 val_ppl=55.69 lr=0.000060 time=1015.04s tok/s=6053
[2025-09-03 04:17:17][Epoch 011] train_loss=3.6209 train_ppl=36.86 val_loss=4.0140 val_ppl=55.37 lr=0.000060 time=1015.62s tok/s=6050
[2025-09-03 04:34:40][Epoch 012] train_loss=3.5977 train_ppl=36.00 val_loss=4.0092 val_ppl=55.10 lr=0.000060 time=1015.60s tok/s=6050
[2025-09-03 04:52:03][Epoch 013] train_loss=3.5748 train_ppl=35.19 val_loss=4.0057 val_ppl=54.91 lr=0.000060 time=1016.25s tok/s=6046
[2025-09-03 05:09:25][Epoch 014] train_loss=3.5528 train_ppl=34.43 val_loss=4.0019 val_ppl=54.70 lr=0.000060 time=1015.54s tok/s=6050
[2025-09-03 05:26:48][Epoch 015] train_loss=3.5313 train_ppl=33.70 val_loss=3.9997 val_ppl=54.58 lr=0.000060 time=1016.09s tok/s=6047
[2025-09-03 05:44:12][Epoch 016] train_loss=3.5106 train_ppl=33.01 val_loss=3.9976 val_ppl=54.47 lr=0.000060 time=1016.87s tok/s=6042
[2025-09-03 06:01:35][Epoch 017] train_loss=3.4906 train_ppl=32.34 val_loss=3.9957 val_ppl=54.36 lr=0.000060 time=1016.71s tok/s=6043
[2025-09-03 06:19:00][Epoch 018] train_loss=3.4710 train_ppl=31.70 val_loss=3.9948 val_ppl=54.31 lr=0.000060 time=1017.50s tok/s=6038
[2025-09-03 06:36:25][Epoch 019] train_loss=3.4511 train_ppl=31.10 val_loss=3.9948 val_ppl=54.32 lr=0.000060 time=1018.58s tok/s=6032
[2025-09-03 06:53:49][Epoch 020] train_loss=3.4324 train_ppl=30.51 val_loss=3.9949 val_ppl=54.32 lr=0.000060 time=1017.27s tok/s=6040
[2025-09-03 07:11:14][Epoch 021] train_loss=3.4137 train_ppl=29.95 val_loss=3.9957 val_ppl=54.36 lr=0.000060 time=1018.19s tok/s=6034
[2025-09-03 07:28:40][Epoch 022] train_loss=3.3956 train_ppl=29.41 val_loss=3.9978 val_ppl=54.48 lr=0.000060 time=1018.78s tok/s=6031
[2025-09-03 07:46:04][Epoch 023] train_loss=3.3781 train_ppl=28.89 val_loss=3.9992 val_ppl=54.56 lr=0.000060 time=1017.48s tok/s=6038
[2025-09-03 08:03:29][Epoch 024] train_loss=3.3605 train_ppl=28.40 val_loss=4.0016 val_ppl=54.69 lr=0.000060 time=1018.06s tok/s=6035
[2025-09-03 08:03:29] Training completed!
Best validation perplexity: 54.31
